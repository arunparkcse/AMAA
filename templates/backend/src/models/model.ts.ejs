import {
  Table, Column, Model, PrimaryKey, AutoIncrement, AllowNull,
  Default, Unique, BelongsTo, ForeignKey, BeforeCreate,
  BeforeUpdate, AfterFind, Paranoid, BeforeSave
} from 'sequelize-typescript';
import bcrypt from 'bcryptjs';
import path from 'path';

@Table({
  tableName: '<%= ent.tableName || toKebab(ent.name) + "s" %>',
  timestamps: true,
  paranoid: <%= !!ent.softDelete %>
})
export class <%= toPascal(ent.name) %> extends Model {
  @PrimaryKey
  @AutoIncrement
  @Column
  declare id: number;

  <% ent.columns.forEach(col => { if (!col.primaryKey) { %>
  @Column({ 
    allowNull: <%= !col.required %>, 
    <% if (col.unique) { %>unique: true,<% } %>
    <% if (col.default !== undefined) { %>defaultValue: <%= JSON.stringify(col.default) %>,<% } %>
  })
  declare <%= col.name %>: <%= col.type === 'string' ? 'string' : col.type === 'integer' ? 'number' : col.type === 'boolean' ? 'boolean' : col.type === 'dateTime' ? 'Date' : 'any' %>;
  <% } }) %>

  <% ent.computed?.forEach(c => { %>
  get <%= c.field %>(): string {
    <%- c.code.replace(/instance\./g, 'this.') %>
  }
  <% }) %>

  <% ent.methods?.forEach(m => { %>
  <%= m.name %>(this: <%= toPascal(ent.name) %>): any {
    <%- m.code %>
  }
  <% }) %>

  <% ent.hooks?.forEach(h => { %>
  @<%= h.event.charAt(0).toUpperCase() + h.event.slice(1) %>
  static async <%= h.event %>(instance: <%= toPascal(ent.name) %>) {
    <%- h.code.replace(/instance\./g, 'instance.') %>
  }
  <% }) %>
}

// Associations
<% ent.relationships?.forEach(r => { %>
<%= toPascal(ent.name) %>.<%= r.type %>(require('./<%= toKebab(r.target) %>'));
<% }) %>

module.exports = <%= toPascal(ent.name) %>;